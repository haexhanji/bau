<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ë°±ì„ì˜ˆëŒ€ ì˜ìƒí•™ë¶€ ì¡¸ì—…ì¤€ë¹„ìœ„ì›íšŒ (ì˜í™”ì½˜í…ì¸ , ì˜ìƒë¯¸ë””ì–´)</title>
  <link rel="stylesheet" href="css/style.css"/>
  <style>
    .notice-actions{ display:flex; gap:8px; margin-top:8px; }
    .btn{ font-size:12px; padding:4px 8px; border-radius:8px; cursor:pointer; background:#fff; }
    .btn-edit{ border:1px solid #2563eb; color:#2563eb; }
    .btn-edit:hover{ background:#dbeafe; }
    .btn-del{ border:1px solid #ef4444; color:#ef4444; }
    .btn-del:hover{ background:#fee2e2; }
    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.35); z-index:50;}
    .modal .panel{ background:#fff; border-radius:14px; padding:16px; width:min(560px,90vw); border:1px solid #e5e7eb; }
    .row{ display:grid; grid-template-columns:100px 1fr; gap:8px; align-items:center; margin:6px 0; }
    .row input, .row textarea{ padding:8px; border:1px solid #e5e7eb; border-radius:8px; width:100%; }
    .actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:10px; }
    .btn-primary{ border:1px solid #111827; color:#111827; }
    .btn-muted{ border:1px solid #e5e7eb; color:#6b7280; }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner container">
      <button id="menutgl" class="mobonly menu" aria-label="ë©”ë‰´">â˜°</button>
      <div class="title">ë°±ì„ì˜ˆëŒ€ ì˜ìƒí•™ë¶€ ì¡¸ì—…ì¤€ë¹„ìœ„ì›íšŒ <span class="subtitle">(ì˜í™”ì½˜í…ì¸ , ì˜ìƒë¯¸ë””ì–´)</span></div>
    </div>
  </header>

  <div class="container layout">
    <aside class="sidebar">
      <a class="navbtn" href="movie.html"><span>ì˜í™”ì½˜í…ì¸ </span></a>
      <a class="navbtn" href="media.html"><span>ì˜ìƒë¯¸ë””ì–´</span></a>
      <a class="navbtn" href="schedule.html"><span>ì „ì²´ì¼ì •</span></a>
      <a class="navbtn active" href="notices.html"><span>ê³µì§€ì‚¬í•­ ëª¨ìŒ</span></a>
      <div class="card" style="margin-top:12px">
        <div class="small"><b>ê³µí†µ ê³µì§€</b><br/>ğŸš¨
ì¡¸ì—…ì¤€ë¹„ìœ„ì›íšŒ ê´€ë ¨ ì‹¤ì‹œê°„ ê³µì§€ë‚˜ íƒ€ì„í…Œì´ë¸” ì—…ë°ì´íŠ¸ëŠ” ì‚¬ì´íŠ¸ë¥¼ í†µí•´ ë¹ ë¥´ê²Œ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³µì§€í˜ì´ì§€ ì—…ë°ì´íŠ¸ë¡œ ì¸í•˜ì—¬ ê³µì§€ë¥¼ ë¡œë“œí•˜ëŠ”ë° ì‹œê°„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.v1.2.4 #update </div>
      </div>
    </aside>

    <main>
      <div class="container" style="margin:16px 0;">
        <button id="adminLogin" class="small">ê´€ë¦¬ì ëª¨ë“œ</button>
      </div>

      <div id="adminBox" class="card" style="display:none;">
        <h3>ê³µì§€ ì—…ë¡œë“œ</h3>
        <form id="noticeForm">
          <div style="display:grid; gap:8px; grid-template-columns: 120px 1fr; align-items:center;">
            <label for="ndate">ë‚ ì§œ</label>
            <input type="date" id="ndate" name="date" required/>
            <label for="ntitle">ì œëª©</label>
            <input type="text" id="ntitle" name="title" placeholder="[ì•ˆë‚´] ì œëª©" required/>
            <label for="nbody">ë³¸ë¬¸</label>
            <textarea id="nbody" name="body" rows="6" placeholder="ê³µì§€ ë³¸ë¬¸(&lt;br&gt; ê°€ëŠ¥)" required></textarea>
          </div>
          <div style="margin-top:12px; display:flex; gap:8px;">
            <button type="submit" class="btn btn-primary">ì—…ë¡œë“œ</button>
            <button type="button" id="adminCancel" class="btn btn-muted">ìˆ¨ê¸°ê¸°</button>
          </div>
        </form>
      </div>

      <div class="card">
        <h2>ê³µì§€ì‚¬í•­ ëª¨ìŒ</h2>
        <p class="muted">ê³µì§€í˜ì´ì§€ ì—…ë°ì´íŠ¸ë¡œ ì¸í•˜ì—¬ ê³µì§€ë¥¼ ë¡œë“œí•˜ëŠ”ë° ì‹œê°„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”</p>
        <div id="noticeList"></div>
      </div>
    </main>
  </div>

  <!-- ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="editModal" class="modal" aria-hidden="true">
    <div class="panel">
      <h3 style="margin:0 0 8px 0;">ê³µì§€ ìˆ˜ì •</h3>
      <div class="row"><label>ë‚ ì§œ</label><input type="date" id="editDate"></div>
      <div class="row"><label>ì œëª©</label><input type="text" id="editTitle"></div>
      <div class="row"><label>ë³¸ë¬¸</label><textarea id="editBody" rows="6"></textarea></div>
      <div class="actions">
        <button id="editCancel" class="btn btn-muted">ì·¨ì†Œ</button>
        <button id="editSave" class="btn btn-primary">ì €ì¥</button>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container small">Â© 2025 ë°±ì„ì˜ˆëŒ€ ì˜ìƒí•™ë¶€ ì¡¸ì—…ì¤€ë¹„ìœ„ì›íšŒ.</div>
  </footer>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwc5l9l0iUD1ZajEMDErHcn3KXB8rTsiI7MwAILMpAJ4aDxObVwYnDYZ2XvvfJEaH8X/exec';
    let ADMIN_PWD = null;

    document.addEventListener('DOMContentLoaded', () => {
      const $date = document.getElementById('ndate');
      if ($date) {
        const t = new Date(); const m = String(t.getMonth()+1).padStart(2,'0'); const d = String(t.getDate()).padStart(2,'0');
        $date.value = `${t.getFullYear()}-${m}-${d}`;
      }
      loadNotices();
    });

    async function loadNotices(){
      const r = await fetch(`${SCRIPT_URL}?mode=list&ts=${Date.now()}`, { cache:'no-store' });
      const items = await r.json();
      renderNotices(Array.isArray(items)?items:[]);
    }
    function renderNotices(items){
      const box = document.getElementById('noticeList');
      if(!items.length){ box.innerHTML='<div class="muted small">ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'; return; }
      const isAdmin = !!ADMIN_PWD;
      box.innerHTML = items.map(it => `
        <div class="notice" data-id="${it.id}">
          <div class="date">${it.date}</div>
          <div class="title">${it.title}</div>
          <div class="body">${it.body}</div>
          ${isAdmin ? `
            <div class="notice-actions">
              <button class="btn btn-edit" data-id="${it.id}" data-date="${it.date}" data-title="${encodeURIComponent(it.title||'')}" data-body="${encodeURIComponent(it.body||'')}">ìˆ˜ì •</button>
              <button class="btn btn-del" data-id="${it.id}">ì‚­ì œ</button>
            </div>` : ``}
        </div>
      `).join('');
    }

    // ê´€ë¦¬ì ë¡œê·¸ì¸
    document.getElementById('adminLogin')?.addEventListener('click', async () => {
      const pwd = prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸');
      if(!pwd) return;
      const r = await fetch(`${SCRIPT_URL}?mode=ping&pwd=${encodeURIComponent(pwd.trim())}`);
      const j = await r.json();
      if(!j.ok) return alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      ADMIN_PWD = pwd.trim();
      document.getElementById('adminBox').style.display='block';
      loadNotices();
    });
    document.getElementById('adminCancel')?.addEventListener('click', ()=>{ document.getElementById('adminBox').style.display='none'; });

    // ì—…ë¡œë“œ(POST)
    document.getElementById('noticeForm')?.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!ADMIN_PWD) return alert('ê´€ë¦¬ì ì¸ì¦ í•„ìš”');
      const f = e.target;
      const body = new URLSearchParams({ mode:'add', pwd:ADMIN_PWD, date:f.date.value, title:f.title.value, body:f.body.value });
      const r = await fetch(SCRIPT_URL, { method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8'}, body });
      const j = await r.json();
      if(!j.ok) return alert('ì—…ë¡œë“œ ì‹¤íŒ¨: '+(j.error||'')); alert('ì—…ë¡œë“œ ì™„ë£Œ'); f.reset(); loadNotices();
    });

    // ìˆ˜ì •/ì‚­ì œ
    const listBox = document.getElementById('noticeList');

    // ì‚­ì œ: GETìœ¼ë¡œ í˜¸ì¶œ
    listBox?.addEventListener('click', async (e)=>{
      const delBtn = e.target.closest('.btn-del'); if(!delBtn) return;
      if(!ADMIN_PWD) return alert('ê´€ë¦¬ì ì¸ì¦ í•„ìš”');
      const id = delBtn.getAttribute('data-id'); if(!id) return;
      if(!confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”? ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;
      const url = `${SCRIPT_URL}?mode=delete&id=${encodeURIComponent(id)}&pwd=${encodeURIComponent(ADMIN_PWD)}&ts=${Date.now()}`;
      const r = await fetch(url, { method:'GET' }); // â† GET
      const j = await r.json();
      if(!j.ok) return alert('ì‚­ì œ ì‹¤íŒ¨: '+(j.error||'')); alert('ì‚­ì œ ì™„ë£Œ'); loadNotices();
    });

    // ìˆ˜ì • ì—´ê¸°
    const modal = document.getElementById('editModal');
    const editDate = document.getElementById('editDate');
    const editTitle = document.getElementById('editTitle');
    const editBody = document.getElementById('editBody');
    let editingId = null;

    listBox?.addEventListener('click', (e)=>{
      const editBtn = e.target.closest('.btn-edit'); if(!editBtn) return;
      if(!ADMIN_PWD) return alert('ê´€ë¦¬ì ì¸ì¦ í•„ìš”');
      editingId = editBtn.getAttribute('data-id');
      editDate.value  = (editBtn.getAttribute('data-date')||'').trim();
      editTitle.value = decodeURIComponent(editBtn.getAttribute('data-title')||'');
      editBody.value  = decodeURIComponent(editBtn.getAttribute('data-body')||'');
      modal.style.display='flex'; modal.setAttribute('aria-hidden','false');
    });

    // ìˆ˜ì • ì €ì¥: GETìœ¼ë¡œ í˜¸ì¶œ
    document.getElementById('editSave')?.addEventListener('click', async ()=>{
      if(!ADMIN_PWD) return alert('ê´€ë¦¬ì ì¸ì¦ í•„ìš”'); if(!editingId) return alert('ì˜ëª»ëœ ìš”ì²­');
      const url = `${SCRIPT_URL}?mode=update&id=${encodeURIComponent(editingId)}&pwd=${encodeURIComponent(ADMIN_PWD)}&date=${encodeURIComponent(editDate.value)}&title=${encodeURIComponent(editTitle.value)}&body=${encodeURIComponent(editBody.value)}&ts=${Date.now()}`;
      const r = await fetch(url, { method:'GET' }); // â† GET
      const j = await r.json();
      if(!j.ok) return alert('ìˆ˜ì • ì‹¤íŒ¨: '+(j.error||'')); alert('ìˆ˜ì • ì™„ë£Œ');
      modal.style.display='none'; modal.setAttribute('aria-hidden','true'); editingId=null; loadNotices();
    });
    document.getElementById('editCancel')?.addEventListener('click', ()=>{
      modal.style.display='none'; modal.setAttribute('aria-hidden','true'); editingId=null;
    });
  </script>
</body>
</html>
