<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ë°±ì„ì˜ˆëŒ€ ì˜ìƒí•™ë¶€ ì¡¸ì—…ì¤€ë¹„ìœ„ì›íšŒ (ì˜í™”ì½˜í…ì¸ , ì˜ìƒë¯¸ë””ì–´)</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
  <header class="header">
    <div class="header-inner container">
      <button id="menutgl" class="mobonly menu" aria-label="ë©”ë‰´">â˜°</button>
      <div class="title">ë°±ì„ì˜ˆëŒ€ ì˜ìƒí•™ë¶€ ì¡¸ì—…ì¤€ë¹„ìœ„ì›íšŒ <span class="subtitle">(ì˜í™”ì½˜í…ì¸ , ì˜ìƒë¯¸ë””ì–´)</span></div>
    </div>
  </header>

  <div class="container layout">
    <aside id="sidebar" class="sidebar">
      <a class="navbtn" data-route="movie" href="movie.html"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="2" y="2" width="20" height="20" rx="2" ry="2"/><circle cx="7" cy="7" r="1"/><circle cx="7" cy="12" r="1"/><circle cx="7" cy="17" r="1"/><path d="M11 7h11M11 12h11M11 17h11"/></svg><span>ì˜í™”ì½˜í…ì¸ </span></a>
      <a class="navbtn" data-route="media" href="media.html"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg><span>ì˜ìƒë¯¸ë””ì–´</span></a>
      <a class="navbtn" data-route="schedule" href="schedule.html"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg><span>ì „ì²´ì¼ì •</span></a>
      <a class="navbtn" data-route="notices" href="notices.html"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 11l18-5v12L3 13v-2z"/><path d="M11 12v7"/></svg><span>ê³µì§€ì‚¬í•­ ëª¨ìŒ</span></a>
      <div class="card" style="margin-top:12px">
        <div class="small"><b>ê³µí†µ ê³µì§€ </b><br/> í˜„ì¬ ì¡¸ì—…ì‹¬ì‚¬ ê´€ë ¨ ìˆ˜ìš”ì¡°ì‚¬ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤. ëª¨ë“  í•™ìƒì€ ë°˜ë“œì‹œ ê¸°í•œ ë‚´ì— ì¡°ì‚¬ì— ì°¸ì—¬í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤. <br><br> ğŸ”” ì•ìœ¼ë¡œ ì¡¸ì—…ì¤€ë¹„ìœ„ì›íšŒ ê´€ë ¨ ê³µì§€ ë° ìˆ˜ìš”ì¡°ì‚¬ëŠ” í•´ë‹¹ ì‚¬ì´íŠ¸ì—ì„œ ì§„í–‰ë  ì˜ˆì •ì…ë‹ˆë‹¤.
        ì¹´ì¹´ì˜¤í†¡ì´ë‚˜ ë¬¸ìë¡œë„ ì•ˆë‚´í•´ ë“œë¦¬ê² ì§€ë§Œ, ì¼ì •ê³¼ ê³µì§€ì‚¬í•­ì€ ì‚¬ì´íŠ¸ì—ì„œ ê³„ì† ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤. ê°€ì¥ ì •í™•í•˜ê³  ìµœì‹  ì •ë³´ëŠ” ì‚¬ì´íŠ¸ì—ì„œ ì§ì ‘ í™•ì¸í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</div>
      </div>
    </aside>

    <main>

      <!-- ê´€ë¦¬ì ì§„ì… ë²„íŠ¼ -->
      <div class="container" style="margin:16px 0;">
        <button id="adminLogin" class="small">ê´€ë¦¬ì ëª¨ë“œ</button>
      </div>

      <!-- ì—…ë¡œë“œ ì¹´ë“œ (ê¸°ë³¸ ìˆ¨ê¹€) -->
      <div id="adminBox" class="card" style="display:none;">
        <h3>ê³µì§€ ì—…ë¡œë“œ</h3>
        <form id="noticeForm">
          <div style="display:grid; gap:8px; grid-template-columns: 120px 1fr; align-items:center;">
            <label for="ndate">ë‚ ì§œ</label>
            <input type="date" id="ndate" name="date" required/>

            <label for="ntitle">ì œëª©</label>
            <input type="text" id="ntitle" name="title" placeholder="[ì•ˆë‚´] ì œëª©" required/>

            <label for="nbody">ë³¸ë¬¸</label>
            <textarea id="nbody" name="body" rows="6" placeholder="ê³µì§€ ë³¸ë¬¸(ì¤„ë°”ê¿ˆì€ <br> ì‚¬ìš© ê°€ëŠ¥)" required></textarea>
          </div>
          <div style="margin-top:12px; display:flex; gap:8px;">
            <button type="submit" class="primary">ì—…ë¡œë“œ</button>
            <button type="button" id="adminCancel">ìˆ¨ê¸°ê¸°</button>
          </div>
          <p class="small muted" style="margin-top:8px;">â€» ê³µì§€ëŠ” ì˜ í™•ì¸í•˜ê³  ì˜¬ë¦¬ê¸°</p>
        </form>
      </div>

      <!-- ê³µì§€ ëª©ë¡ -->
      <div class="card">
        <h2>ê³µì§€ì‚¬í•­ ëª¨ìŒ</h2>
        <p class="muted">ì¤‘ìš” ê³µì§€ë¥¼ ë¹ ë¥´ê²Œ ëª¨ì•„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <div id="noticeList"><!-- JSì—ì„œ ë Œë”ë§ --></div>
      </div>

    </main>
  </div>

  <footer class="footer">
    <div class="container small">
      Â© 2025 ë°±ì„ì˜ˆëŒ€ ì˜ìƒí•™ë¶€ ì¡¸ì—…ì¤€ë¹„ìœ„ì›íšŒ. All rights reserved. Â· <a href="https://calendar.google.com" target="_blank">Google Calendar</a> Â· <a href="https://docs.google.com/forms" target="_blank">Google Forms</a>
    </div>
  </footer>

  <script>
    // === Apps Script ì›¹ì•± URL ===
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyO4o5rlRJCynwnuQPUbW3ZSgODlmMl_jBNZXwHqBlOmhJaHv4GggYl8vwKbf1EzYNf/exec';

    // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë³¸ê°’
    document.addEventListener('DOMContentLoaded', () => {
      const $date = document.getElementById('ndate');
      if ($date) {
        const t = new Date();
        const m = String(t.getMonth()+1).padStart(2,'0');
        const d = String(t.getDate()).padStart(2,'0');
        $date.value = `${t.getFullYear()}-${m}-${d}`;
      }
    });

    // ê³µì§€ ëª©ë¡ ë¡œë“œ
    async function loadNotices(){
      try{
        const r = await fetch(`${SCRIPT_URL}?mode=list`, { cache:'no-store' });
        const items = await r.json();
        renderNotices(Array.isArray(items) ? items : []);
      }catch(e){ console.error(e); }
    }
    function renderNotices(items){
      const box = document.getElementById('noticeList');
      if(!box) return;
      if(!items.length){
        box.innerHTML = '<div class="muted small">ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      box.innerHTML = items.map(it => `
        <div class="notice">
          <div class="date">${escapeHtml(it.date || '')}</div>
          <div class="title">${escapeHtml(it.title || '')}</div>
          <div class="body">${it.body || ''}</div>
        </div>
      `).join('');
    }
    function escapeHtml(str){
      return String(str).replace(/[&<>\"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
    }

    // ê´€ë¦¬ì ëª¨ë“œ
    let ADMIN_PWD = null;
    const adminBtn    = document.getElementById('adminLogin');
    const adminBox    = document.getElementById('adminBox');
    const adminCancel = document.getElementById('adminCancel');

    adminBtn && (adminBtn.onclick = async () => {
      const pwd = prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
      if(!pwd) return;
      const ok = await pingPassword(pwd);
      if(!ok){ alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
      ADMIN_PWD = (pwd || '').trim(); // trim ë³´ê´€
      adminBox.style.display = 'block';
    });

    adminCancel && (adminCancel.onclick = () => {
      adminBox.style.display = 'none';
    });

    async function pingPassword(pwd){
      try{
        const p = (pwd || '').trim(); // trimí•´ì„œ ì „ì†¡
        const r = await fetch(`${SCRIPT_URL}?mode=ping&pwd=${encodeURIComponent(p)}`);
        const j = await r.json();
        return !!j.ok;
      }catch(e){ console.error(e); return false; }
    }

    // ì—…ë¡œë“œ (FormData ì „ì†¡: preflight íšŒí”¼)
    const noticeForm = document.getElementById('noticeForm');
    noticeForm && noticeForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      if(!ADMIN_PWD) return alert('ê´€ë¦¬ì ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.');

      const fd = new FormData(noticeForm);
      fd.append('mode', 'add');
      fd.append('pwd', (ADMIN_PWD || '').trim()); // trimí•´ì„œ ì „ì†¡

      try{
        const r = await fetch(SCRIPT_URL, { method:'POST', body: fd }); // í—¤ë” ì§€ì • X
        const j = await r.json();
        if(!j.ok) return alert('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + (j.error || 'UNKNOWN'));
        alert('ì—…ë¡œë“œ ì™„ë£Œ');
        noticeForm.reset();
        loadNotices();
      }catch(e2){
        console.error(e2);
        alert('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
      }
    });

    // ì²« ë¡œë“œ
    window.addEventListener('DOMContentLoaded', loadNotices);
  </script>

  <script src="js/app.js"></script>
</body>
</html>
